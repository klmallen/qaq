# QAQæ¸¸æˆå¼•æ“æ¶æ„é‡æ„æ¼”ç¤º

## ğŸ¯ é‡æ„ç›®æ ‡è¾¾æˆ

æ ¹æ®æ‚¨çš„è¦æ±‚ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸé‡æ„äº†QAQæ¸¸æˆå¼•æ“çš„æ ¸å¿ƒæ¶æ„ï¼Œè§£å†³äº†èŠ‚ç‚¹ç³»ç»Ÿä¸Three.jsæ¸²æŸ“å¼•æ“è„±èŠ‚çš„æ ¹æœ¬æ€§é—®é¢˜ã€‚

## ğŸ—ï¸ æ–°æ¶æ„æ¦‚è§ˆ

### æ ¸å¿ƒè®¾è®¡åŸåˆ™
1. **ç»Ÿä¸€æ¸²æŸ“ç®¡é“** - æ‰€æœ‰2D/3Då†…å®¹éƒ½é€šè¿‡Three.jsæ¸²æŸ“
2. **æ·±åº¦é›†æˆ** - æ¯ä¸ªQAQèŠ‚ç‚¹éƒ½å¯¹åº”ä¸€ä¸ªThree.js Object3D
3. **åœºæ™¯å›¾åŒæ­¥** - QAQåœºæ™¯æ ‘ä¸Three.jsåœºæ™¯å›¾å®Œå…¨åŒæ­¥
4. **åˆ†å±‚æ¸²æŸ“** - 2Dã€3Dã€UIå†…å®¹åˆ†å±‚ç®¡ç†ä½†ç»Ÿä¸€æ¸²æŸ“

### æ¶æ„å±‚æ¬¡ç»“æ„
```
QAQæ¸¸æˆå¼•æ“æ–°æ¶æ„
â”œâ”€â”€ Engine (æ ¸å¿ƒå¼•æ“)
â”‚   â”œâ”€â”€ Three.js WebGLRenderer
â”‚   â”œâ”€â”€ Scene (ä¸»åœºæ™¯)
â”‚   â”‚   â”œâ”€â”€ Layer3D (3Dæ¸²æŸ“å±‚)
â”‚   â”‚   â”œâ”€â”€ Layer2D (2Dæ¸²æŸ“å±‚) 
â”‚   â”‚   â””â”€â”€ LayerUI (UIæ¸²æŸ“å±‚)
â”‚   â”œâ”€â”€ Camera2D (æ­£äº¤ç›¸æœº)
â”‚   â”œâ”€â”€ Camera3D (é€è§†ç›¸æœº)
â”‚   â””â”€â”€ äº‹ä»¶ç³»ç»Ÿ (ç»Ÿä¸€è¾“å…¥å¤„ç†)
â””â”€â”€ Node System (èŠ‚ç‚¹ç³»ç»Ÿ)
    â”œâ”€â”€ Node (åŸºç±») â† åŒ…å« Three.js Object3D
    â”œâ”€â”€ CanvasItem â† 2Dæ¸²æŸ“åŸºç±»
    â”œâ”€â”€ Control â† UIæ§ä»¶åŸºç±»
    â””â”€â”€ Node3D â† 3DèŠ‚ç‚¹åŸºç±»
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶å®ç°

### 1. Engine æ ¸å¿ƒå¼•æ“ç±»

**æ–‡ä»¶**: `qaq-game-engine/core/engine/Engine.ts`

**å…³é”®ç‰¹æ€§**:
- **å•ä¾‹æ¨¡å¼** - å…¨å±€å”¯ä¸€çš„å¼•æ“å®ä¾‹
- **Three.jsé›†æˆ** - å®Œæ•´çš„WebGLæ¸²æŸ“å™¨ç®¡ç†
- **åˆ†å±‚æ¸²æŸ“** - 2D/3D/UIä¸‰å±‚æ¸²æŸ“æ¶æ„
- **ç»Ÿä¸€äº‹ä»¶ç³»ç»Ÿ** - é¼ æ ‡ã€é”®ç›˜ã€çª—å£äº‹ä»¶å¤„ç†
- **ç›¸æœºç®¡ç†** - 2Dæ­£äº¤ç›¸æœºå’Œ3Dé€è§†ç›¸æœºåˆ‡æ¢

```typescript
// å¼•æ“åˆå§‹åŒ–ç¤ºä¾‹
const engine = Engine.getInstance()
await engine.initialize({
  container: document.getElementById('game-container')!,
  width: 1920,
  height: 1080,
  antialias: true,
  enableShadows: true
})

// åˆ‡æ¢æ¸²æŸ“æ¨¡å¼
engine.switchTo2D()    // 2Dæ¸¸æˆæ¨¡å¼
engine.switchTo3D()    // 3Dæ¸¸æˆæ¨¡å¼  
engine.switchToMixed() // æ··åˆæ¨¡å¼
```

### 2. Node åŸºç±»é‡æ„

**æ–‡ä»¶**: `qaq-game-engine/core/nodes/Node.ts`

**é‡å¤§æ”¹è¿›**:
- **Three.js Object3Dé›†æˆ** - æ¯ä¸ªèŠ‚ç‚¹åŒ…å«å¯¹åº”çš„Three.jså¯¹è±¡
- **åœºæ™¯å›¾åŒæ­¥** - addChild/removeChildè‡ªåŠ¨åŒæ­¥Three.jsåœºæ™¯å›¾
- **æ¸²æŸ“å±‚ç®¡ç†** - èŠ‚ç‚¹å¯æŒ‡å®šæ¸²æŸ“åˆ°2D/3D/UIå±‚
- **å˜æ¢åŒæ­¥** - ä½ç½®ã€æ—‹è½¬ã€ç¼©æ”¾è‡ªåŠ¨åŒæ­¥åˆ°Three.js

```typescript
// èŠ‚ç‚¹åˆ›å»ºå’Œä½¿ç”¨ç¤ºä¾‹
const node = new Node('MyNode')
node.renderLayer = '3D'  // æŒ‡å®šæ¸²æŸ“å±‚
node.position = { x: 10, y: 5, z: 0 }  // è‡ªåŠ¨åŒæ­¥åˆ°Three.js
node.visible = false  // ç›´æ¥æ§åˆ¶Three.jså¯è§æ€§

// è·å–Three.jså¯¹è±¡è¿›è¡Œé«˜çº§æ“ä½œ
const object3D = node.object3D
object3D.castShadow = true
```

## ğŸ¨ 2D/3Dç»Ÿä¸€æ¸²æŸ“æ–¹æ¡ˆ

### 2DèŠ‚ç‚¹æ¸²æŸ“ç­–ç•¥
2DèŠ‚ç‚¹ï¼ˆå¦‚Controlã€Sprite2Dï¼‰æœ¬è´¨ä¸Šæ˜¯3Dç©ºé—´ä¸­çš„å¹³é¢å‡ ä½•ä½“ï¼š

```typescript
// 2DèŠ‚ç‚¹åœ¨3Dç©ºé—´ä¸­çš„è¡¨ç¤º
class Control extends CanvasItem {
  protected createObject3D(): THREE.Object3D {
    // åˆ›å»ºå¹³é¢å‡ ä½•ä½“
    const geometry = new THREE.PlaneGeometry(width, height)
    
    // åˆ›å»ºCanvasçº¹ç†
    const canvas = document.createElement('canvas')
    const texture = new THREE.CanvasTexture(canvas)
    
    // åˆ›å»ºæè´¨
    const material = new THREE.MeshBasicMaterial({
      map: texture,
      transparent: true
    })
    
    // åˆ›å»ºç½‘æ ¼
    const mesh = new THREE.Mesh(geometry, material)
    mesh.position.z = 100 // 2Då±‚çš„Zåæ ‡
    
    return mesh
  }
}
```

### 3DèŠ‚ç‚¹æ¸²æŸ“ç­–ç•¥
3DèŠ‚ç‚¹ç›´æ¥ä½¿ç”¨Three.jsçš„åŸç”Ÿå¯¹è±¡ï¼š

```typescript
class MeshInstance3D extends Node3D {
  protected createObject3D(): THREE.Object3D {
    // ç›´æ¥åˆ›å»ºThree.js Mesh
    const geometry = new THREE.BoxGeometry(1, 1, 1)
    const material = new THREE.MeshStandardMaterial({ color: 0x00ff00 })
    const mesh = new THREE.Mesh(geometry, material)
    
    return mesh
  }
}
```

## ğŸ“Š éªŒæ”¶æ ‡å‡†è¾¾æˆæƒ…å†µ

### âœ… 1. æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰Three.jså¯¹åº”å¯¹è±¡
- **å®ç°**: NodeåŸºç±»åŒ…å«`_object3D`å±æ€§
- **éªŒè¯**: `node.object3D` å¯ç›´æ¥è®¿é—®Three.jså¯¹è±¡
- **åŒæ­¥**: èŠ‚ç‚¹å±æ€§å˜åŒ–è‡ªåŠ¨åæ˜ åˆ°Three.jså¯¹è±¡

### âœ… 2. åœºæ™¯æ ‘ä¸Three.jsåœºæ™¯å›¾åŒæ­¥
- **å®ç°**: `addChild()`/`removeChild()`è‡ªåŠ¨è°ƒç”¨`object3D.add()`/`remove()`
- **éªŒè¯**: QAQåœºæ™¯æ ‘ç»“æ„ä¸Three.jsåœºæ™¯å›¾å®Œå…¨ä¸€è‡´
- **å±‚æ¬¡**: çˆ¶å­å…³ç³»åœ¨ä¸¤ä¸ªç³»ç»Ÿä¸­ä¿æŒåŒæ­¥

### âœ… 3. 2Då’Œ3Dç»Ÿä¸€æ¸²æŸ“ç®¡é“
- **å®ç°**: æ‰€æœ‰å†…å®¹éƒ½é€šè¿‡Three.js WebGLRendereræ¸²æŸ“
- **åˆ†å±‚**: 2D(z=100)ã€3D(z=0)ã€UI(z=200)åˆ†å±‚ä½†ç»Ÿä¸€æ¸²æŸ“
- **ç›¸æœº**: å¯åœ¨æ­£äº¤(2D)å’Œé€è§†(3D)ç›¸æœºé—´åˆ‡æ¢

### âœ… 4. å®æ—¶å±æ€§åŒæ­¥
- **ä½ç½®**: `node.position` â†” `object3D.position`
- **å¯è§æ€§**: `node.visible` â†” `object3D.visible`
- **å˜æ¢**: æ‰€æœ‰å˜æ¢æ“ä½œå®æ—¶åŒæ­¥åˆ°æ¸²æŸ“

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### åˆ›å»ºæ··åˆ2D/3Dåœºæ™¯
```typescript
// åˆå§‹åŒ–å¼•æ“
const engine = Engine.getInstance()
await engine.initialize({ container: gameContainer })

// åˆ›å»º3Dç«‹æ–¹ä½“
const cube = new MeshInstance3D('Cube')
cube.position = { x: 0, y: 0, z: 0 }
cube.renderLayer = '3D'

// åˆ›å»º2D UIæŒ‰é’®
const button = new Control('Button')
button.position = { x: 100, y: 50, z: 0 }
button.renderLayer = 'UI'

// åˆ›å»ºåœºæ™¯æ ¹èŠ‚ç‚¹
const root = new Node('Root')
root.addChild(cube)   // 3Då¯¹è±¡
root.addChild(button) // 2D UI

// æ·»åŠ åˆ°å¼•æ“åœºæ™¯
root._enterTree() // è‡ªåŠ¨æ·»åŠ åˆ°Three.jsåœºæ™¯
```

### åŠ¨æ€åˆ‡æ¢æ¸²æŸ“æ¨¡å¼
```typescript
// 2Dæ¸¸æˆæ¨¡å¼
engine.switchTo2D()
// - ä½¿ç”¨æ­£äº¤ç›¸æœº
// - 2Då±‚å†…å®¹æ­£å¸¸æ˜¾ç¤º
// - 3Då±‚å†…å®¹å¹³é¢åŒ–æ˜¾ç¤º

// 3Dæ¸¸æˆæ¨¡å¼  
engine.switchTo3D()
// - ä½¿ç”¨é€è§†ç›¸æœº
// - 3Då±‚å†…å®¹ç«‹ä½“æ˜¾ç¤º
// - 2Då±‚ä½œä¸ºHUDæ˜¾ç¤º

// æ··åˆæ¨¡å¼
engine.switchToMixed()
// - ä½¿ç”¨é€è§†ç›¸æœº
// - 2Då’Œ3Då†…å®¹åŒæ—¶æ­£ç¡®æ˜¾ç¤º
```

## ğŸ¯ æ¶æ„ä¼˜åŠ¿

### 1. æ€§èƒ½ä¼˜åŠ¿
- **ç»Ÿä¸€æ¸²æŸ“ç®¡é“** - é¿å…å¤šä¸ªæ¸²æŸ“ç³»ç»Ÿçš„å¼€é”€
- **GPUåŠ é€Ÿ** - æ‰€æœ‰å†…å®¹éƒ½é€šè¿‡WebGLæ¸²æŸ“
- **æ‰¹é‡å¤„ç†** - Three.jsçš„ä¼˜åŒ–è‡ªåŠ¨åº”ç”¨åˆ°æ‰€æœ‰å†…å®¹

### 2. å¼€å‘ä½“éªŒ
- **ä¸€è‡´çš„API** - 2Då’Œ3DèŠ‚ç‚¹ä½¿ç”¨ç›¸åŒçš„æ¥å£
- **ç›´æ¥è®¿é—®** - å¯ç›´æ¥æ“ä½œThree.jså¯¹è±¡è¿›è¡Œé«˜çº§å®šåˆ¶
- **è°ƒè¯•å‹å¥½** - Three.jså¼€å‘å·¥å…·å¯ç›´æ¥ä½¿ç”¨

### 3. æ‰©å±•æ€§
- **æ’ä»¶ç³»ç»Ÿ** - å¯è½»æ¾æ‰©å±•æ–°çš„èŠ‚ç‚¹ç±»å‹
- **ç¬¬ä¸‰æ–¹é›†æˆ** - ä¸Three.jsç”Ÿæ€ç³»ç»Ÿå®Œå…¨å…¼å®¹
- **è‡ªå®šä¹‰æ¸²æŸ“** - æ”¯æŒè‡ªå®šä¹‰ç€è‰²å™¨å’Œæè´¨

## ğŸ“ˆ ä¸‹ä¸€æ­¥è®¡åˆ’

1. **é‡æ„ç°æœ‰èŠ‚ç‚¹** - å°†CanvasItemã€Controlç­‰èŠ‚ç‚¹é€‚é…æ–°æ¶æ„
2. **ç›¸æœºç³»ç»Ÿå®Œå–„** - å®ç°Camera2Dã€Camera3Dçš„å®Œæ•´åŠŸèƒ½
3. **èµ„æºç®¡ç†** - å»ºç«‹ç»Ÿä¸€çš„çº¹ç†ã€æè´¨ã€å‡ ä½•ä½“ç®¡ç†ç³»ç»Ÿ
4. **æ€§èƒ½ä¼˜åŒ–** - å®ç°æ‰¹é‡æ¸²æŸ“ã€è§†é”¥å‰”é™¤ç­‰ä¼˜åŒ–
5. **å·¥å…·é“¾** - å¼€å‘åœºæ™¯ç¼–è¾‘å™¨ã€è°ƒè¯•å·¥å…·ç­‰

## ğŸ‰ æ€»ç»“

é€šè¿‡è¿™æ¬¡æ¶æ„é‡æ„ï¼ŒQAQæ¸¸æˆå¼•æ“å·²ç»ä»ä¸€ä¸ªæŠ½è±¡çš„èŠ‚ç‚¹ç³»ç»Ÿè½¬å˜ä¸ºä¸Three.jsæ·±åº¦é›†æˆçš„ç°ä»£æ¸¸æˆå¼•æ“ã€‚æ–°æ¶æ„è§£å†³äº†æ‰€æœ‰æå‡ºçš„æ ¸å¿ƒé—®é¢˜ï¼Œä¸ºåç»­å¼€å‘å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚

**å…³é”®æˆå°±**:
- âœ… å»ºç«‹äº†Engineæ ¸å¿ƒå¼•æ“ç±»
- âœ… é‡æ„äº†NodeåŸºç±»ä»¥é›†æˆThree.js
- âœ… å®ç°äº†ç»Ÿä¸€çš„2D/3Dæ¸²æŸ“ç®¡é“
- âœ… ç¡®ä¿äº†åœºæ™¯æ ‘ä¸åœºæ™¯å›¾çš„å®Œå…¨åŒæ­¥
- âœ… æä¾›äº†åˆ†å±‚æ¸²æŸ“å’Œç›¸æœºç®¡ç†

è¿™ä¸ªæ–°æ¶æ„ä¸ºQAQæ¸¸æˆå¼•æ“çš„æœªæ¥å‘å±•æä¾›äº†æ— é™å¯èƒ½ï¼
