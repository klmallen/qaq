# QAQæ¸¸æˆå¼•æ“ - åŠ¨ç”»ç³»ç»ŸåŠŸèƒ½åˆ†ææŠ¥å‘Š

## ğŸ“Š **å½“å‰AnimationPlayeråŠŸèƒ½è¯„ä¼°**

### âœ… **å·²å®ç°çš„æ ¸å¿ƒåŠŸèƒ½**

#### 1. **åŸºç¡€åŠ¨ç”»æ’­æ”¾æ§åˆ¶**
- âœ… `play()` - æ’­æ”¾æŒ‡å®šåŠ¨ç”»
- âœ… `pause()` - æš‚åœå½“å‰åŠ¨ç”»
- âœ… `stop()` - åœæ­¢åŠ¨ç”»æ’­æ”¾
- âœ… `playBackwards()` - åå‘æ’­æ”¾
- âœ… æ’­æ”¾é€Ÿåº¦æ§åˆ¶ (`_speed`)
- âœ… å¾ªç¯æ’­æ”¾æ”¯æŒ

#### 2. **ç®€å•åŠ¨ç”»æ··åˆ**
- âœ… åŸºç¡€crossfadeæ··åˆ (`_defaultBlendTime`)
- âœ… è‡ªå®šä¹‰æ··åˆæ—¶é—´å‚æ•°
- âœ… `_enableBlending` å¼€å…³

#### 3. **åŸºç¡€äº‹ä»¶ç³»ç»Ÿ**
- âœ… åŠ¨ç”»ç”Ÿå‘½å‘¨æœŸä¿¡å·ï¼š
  - `animation_started`
  - `animation_finished` 
  - `animation_changed`
  - `animation_looped`
  - `animation_step`
- âœ… Three.jsäº‹ä»¶ç›‘å¬é›†æˆ

#### 4. **Three.jsé›†æˆ**
- âœ… `AnimationMixer` ç®¡ç†
- âœ… `AnimationAction` åˆ›å»ºå’Œç®¡ç†
- âœ… è‡ªåŠ¨æ›´æ–°å¾ªç¯

### âŒ **ç¼ºå¤±çš„ä¸“ä¸šçº§åŠŸèƒ½**

#### 1. **é«˜çº§åŠ¨ç”»è¿‡æ¸¡å’Œæ··åˆ**
- âŒ **å¹³æ»‘è¿‡æ¸¡ç³»ç»Ÿ** - æ— é¢„é…ç½®çš„åŠ¨ç”»è¿‡æ¸¡
- âŒ **è¿‡æ¸¡æ›²çº¿æ§åˆ¶** - ç¼ºå°‘ease-in/outç­‰æ›²çº¿
- âŒ **åŠ¨ç”»é˜Ÿåˆ—** - æ— æ³•æ’é˜Ÿæ’­æ”¾åŠ¨ç”»åºåˆ—
- âŒ **æ··åˆæ ‘** - æ— åŸºäºå‚æ•°çš„å¤šåŠ¨ç”»æ··åˆ

#### 2. **å¸§äº‹ä»¶ç³»ç»Ÿ**
- âŒ **å¸§å›è°ƒ** - æ— æ³•åœ¨åŠ¨ç”»ç‰¹å®šæ—¶é—´ç‚¹è§¦å‘äº‹ä»¶
- âŒ **åµŒå…¥å¼äº‹ä»¶** - ä¸æ”¯æŒåŠ¨ç”»æ–‡ä»¶ä¸­çš„äº‹ä»¶æ•°æ®
- âŒ **äº‹ä»¶å‚æ•°ä¼ é€’** - æ— æ³•ä¼ é€’è‡ªå®šä¹‰å‚æ•°

#### 3. **åŠ¨ç”»å±‚å’Œé®ç½©**
- âŒ **å¤šå±‚åŠ¨ç”»** - æ— æ³•åŒæ—¶æ’­æ”¾å¤šä¸ªåŠ¨ç”»
- âŒ **éª¨éª¼é®ç½©** - æ— æ³•é™åˆ¶åŠ¨ç”»å½±å“çš„éª¨éª¼
- âŒ **å±‚æƒé‡æ§åˆ¶** - æ— æ³•è°ƒæ•´ä¸åŒå±‚çš„å½±å“å¼ºåº¦

#### 4. **åŠ¨ç”»å…ƒæ•°æ®ç®¡ç†**
- âŒ **æ¯åŠ¨ç”»é…ç½®** - æ— æ³•ä¸ºå•ä¸ªåŠ¨ç”»è®¾ç½®å±æ€§
- âŒ **åŠ¨ç”»åˆ†ç»„** - æ— æ³•æŒ‰ç±»åˆ«ç»„ç»‡åŠ¨ç”»
- âŒ **ä¼˜å…ˆçº§ç³»ç»Ÿ** - æ— æ³•åŸºäºä¼˜å…ˆçº§æ’­æ”¾åŠ¨ç”»

#### 5. **é«˜çº§æ’­æ”¾æ§åˆ¶**
- âŒ **æ—¶é—´è½´æ§åˆ¶** - æ— æ³•è·³è½¬åˆ°ç‰¹å®šæ—¶é—´ç‚¹
- âŒ **æ’­æ”¾åŒºé—´** - æ— æ³•æ’­æ”¾åŠ¨ç”»çš„ä¸€éƒ¨åˆ†
- âŒ **åŠ¨æ€åŠ è½½** - æ— æ³•è¿è¡Œæ—¶åŠ è½½/å¸è½½åŠ¨ç”»

## ğŸš€ **å¢å¼ºç‰ˆAnimationPlayerè§£å†³æ–¹æ¡ˆ**

æˆ‘å·²ç»åˆ›å»ºäº† `EnhancedAnimationPlayer` ç±»ï¼Œå®ç°äº†æ‰€æœ‰ç¼ºå¤±çš„ä¸“ä¸šçº§åŠŸèƒ½ï¼š

### ğŸ¯ **æ–°å¢æ ¸å¿ƒåŠŸèƒ½**

#### 1. **é«˜çº§åŠ¨ç”»è¿‡æ¸¡ç³»ç»Ÿ**
```typescript
// é…ç½®åŠ¨ç”»è¿‡æ¸¡
animPlayer.addTransition({
  from: 'idle',
  to: 'walk', 
  duration: 0.3,
  curve: 'ease-out'
})

// å¹³æ»‘è¿‡æ¸¡
animPlayer.transitionTo('walk')
```

#### 2. **å¸§äº‹ä»¶å›è°ƒç³»ç»Ÿ**
```typescript
// æ·»åŠ å¸§äº‹ä»¶
animPlayer.addFrameEvent({
  animationName: 'walk',
  time: 0.2,
  eventName: 'footstep',
  parameters: ['grass', 0.8],
  callback: (surface, volume) => {
    playFootstepSound(surface, volume)
  }
})
```

#### 3. **åŠ¨ç”»å±‚ç®¡ç†**
```typescript
// æ·»åŠ ä¸ŠåŠèº«åŠ¨ç”»å±‚
animPlayer.addLayer('upper_body', 0.8, [
  'spine', 'chest', 'shoulder_L', 'shoulder_R'
])

// åœ¨æŒ‡å®šå±‚æ’­æ”¾åŠ¨ç”»
animPlayer.playOnLayer('upper_body', 'wave_hand')
```

#### 4. **åŠ¨ç”»å…ƒæ•°æ®ç³»ç»Ÿ**
```typescript
// è®¾ç½®åŠ¨ç”»å±æ€§
animPlayer.setAnimationMetadata('attack', {
  loop: false,
  blendTime: 0.1,
  priority: 10,
  group: 'combat'
})

// æŒ‰ä¼˜å…ˆçº§æ’­æ”¾
animPlayer.playByPriority('attack')
```

#### 5. **æ··åˆæ ‘æ§åˆ¶**
```typescript
// æ·»åŠ æ··åˆå‚æ•°
animPlayer.addBlendParameter('speed', 0, 10, 0)

// åŸºäºå‚æ•°è‡ªåŠ¨æ··åˆwalk/run
animPlayer.setBlendParameter('speed', 7.5)
```

#### 6. **åŠ¨ç”»é˜Ÿåˆ—ç³»ç»Ÿ**
```typescript
// æ’é˜Ÿæ’­æ”¾åŠ¨ç”»åºåˆ—
animPlayer.queueAnimation('attack1')
animPlayer.queueAnimation('attack2') 
animPlayer.queueAnimation('idle')
animPlayer.playNext()
```

### ğŸ“ˆ **åŠŸèƒ½å¯¹æ¯”è¡¨**

| åŠŸèƒ½ç±»åˆ« | åŸºç¡€AnimationPlayer | EnhancedAnimationPlayer | ä¸“ä¸šå¼•æ“æ ‡å‡† |
|---------|-------------------|----------------------|------------|
| åŸºç¡€æ’­æ”¾æ§åˆ¶ | âœ… å®Œæ•´ | âœ… å®Œæ•´ | âœ… |
| åŠ¨ç”»æ··åˆ | âš ï¸ åŸºç¡€ | âœ… é«˜çº§ | âœ… |
| è¿‡æ¸¡ç³»ç»Ÿ | âŒ ç¼ºå¤± | âœ… å®Œæ•´ | âœ… |
| å¸§äº‹ä»¶ | âŒ ç¼ºå¤± | âœ… å®Œæ•´ | âœ… |
| åŠ¨ç”»å±‚ | âŒ ç¼ºå¤± | âœ… å®Œæ•´ | âœ… |
| å…ƒæ•°æ®ç®¡ç† | âŒ ç¼ºå¤± | âœ… å®Œæ•´ | âœ… |
| æ··åˆæ ‘ | âŒ ç¼ºå¤± | âœ… åŸºç¡€ | âœ… |
| é˜Ÿåˆ—ç³»ç»Ÿ | âŒ ç¼ºå¤± | âœ… å®Œæ•´ | âœ… |
| è°ƒè¯•å·¥å…· | âš ï¸ åŸºç¡€ | âœ… å®Œæ•´ | âœ… |

### ğŸ® **å®é™…åº”ç”¨åœºæ™¯**

#### 1. **è§’è‰²ç§»åŠ¨åŠ¨ç”»**
```typescript
// æ ¹æ®ç§»åŠ¨é€Ÿåº¦è‡ªåŠ¨é€‰æ‹©å’Œæ··åˆåŠ¨ç”»
function updateMovementAnimation(speed: number) {
  animPlayer.setBlendParameter('speed', speed)
  
  if (speed < 0.1) {
    animPlayer.transitionTo('idle')
  } else if (speed < 5) {
    animPlayer.transitionTo('walk') 
  } else {
    animPlayer.transitionTo('run')
  }
}
```

#### 2. **æˆ˜æ–—ç³»ç»Ÿé›†æˆ**
```typescript
// æ”»å‡»åŠ¨ç”»ä¸ä¼¤å®³åˆ¤å®š
animPlayer.addFrameEvent({
  animationName: 'sword_attack',
  time: 0.4, // æ”»å‡»ç”Ÿæ•ˆå¸§
  eventName: 'damage_frame',
  callback: () => {
    dealDamageToEnemies()
  }
})
```

#### 3. **å¤æ‚åŠ¨ç”»åºåˆ—**
```typescript
// æŠ€èƒ½è¿å‡»
function performComboSkill() {
  animPlayer.clearQueue()
  animPlayer.queueAnimation('skill_windup')
  animPlayer.queueAnimation('skill_cast') 
  animPlayer.queueAnimation('skill_recovery')
  animPlayer.queueAnimation('idle')
  animPlayer.playNext()
}
```

## ğŸ”§ **é›†æˆå»ºè®®**

### 1. **æ¸è¿›å¼å‡çº§**
- ä¿æŒç°æœ‰AnimationPlayerçš„APIå…¼å®¹æ€§
- EnhancedAnimationPlayerç»§æ‰¿è‡ªAnimationPlayer
- å¯ä»¥é€æ­¥è¿ç§»åˆ°å¢å¼ºç‰ˆæœ¬

### 2. **æ€§èƒ½ä¼˜åŒ–**
- å¸§äº‹ä»¶æ£€æŸ¥ä¼˜åŒ–ï¼ˆé¿å…æ¯å¸§éå†ï¼‰
- åŠ¨ç”»å±‚çš„æ™ºèƒ½æ›´æ–°
- æ··åˆæ ‘çš„ç¼“å­˜æœºåˆ¶

### 3. **å·¥å…·é“¾æ”¯æŒ**
- åŠ¨ç”»ç¼–è¾‘å™¨é›†æˆ
- å¯è§†åŒ–è¿‡æ¸¡é…ç½®
- å®æ—¶è°ƒè¯•é¢æ¿

## ğŸ¯ **ç»“è®º**

å½“å‰çš„AnimationPlayerå®ç°äº†åŸºç¡€çš„åŠ¨ç”»æ’­æ”¾åŠŸèƒ½ï¼Œä½†ç¼ºå°‘ä¸“ä¸šæ¸¸æˆå¼•æ“å¿…éœ€çš„é«˜çº§ç‰¹æ€§ã€‚é€šè¿‡EnhancedAnimationPlayerï¼ŒQAQå¼•æ“ç°åœ¨å…·å¤‡äº†ï¼š

- âœ… **ä¸šç•Œæ ‡å‡†çš„åŠ¨ç”»è¿‡æ¸¡ç³»ç»Ÿ**
- âœ… **å¼ºå¤§çš„å¸§äº‹ä»¶å›è°ƒæœºåˆ¶** 
- âœ… **çµæ´»çš„å¤šå±‚åŠ¨ç”»æ”¯æŒ**
- âœ… **æ™ºèƒ½çš„åŠ¨ç”»å…ƒæ•°æ®ç®¡ç†**
- âœ… **åŸºç¡€çš„æ··åˆæ ‘åŠŸèƒ½**

è¿™ä½¿å¾—QAQå¼•æ“çš„åŠ¨ç”»ç³»ç»Ÿè¾¾åˆ°äº†ä¸“ä¸šæ¸¸æˆå¼•æ“çš„æ°´å‡†ï¼Œèƒ½å¤Ÿæ”¯æŒå¤æ‚çš„æ¸¸æˆåŠ¨ç”»éœ€æ±‚ã€‚ğŸš€
